var J=Object.defineProperty;var x=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var j=(g,m,s)=>m in g?J(g,m,{enumerable:!0,configurable:!0,writable:!0,value:s}):g[m]=s,T=(g,m)=>{for(var s in m||(m={}))H.call(m,s)&&j(g,s,m[s]);if(x)for(var s of x(m))k.call(m,s)&&j(g,s,m[s]);return g};var a=(g,m,s)=>new Promise((S,R)=>{var C=h=>{try{E(s.next(h))}catch(f){R(f)}},I=h=>{try{E(s.throw(h))}catch(f){R(f)}},E=h=>h.done?S(h.value):Promise.resolve(h.value).then(C,I);E((s=s.apply(g,m)).next())});(function(){"use strict";class g{createLoadingElement(){const e=document.createElement("div");return e.className="shelf-container",e.innerHTML=this.getLoadingTemplate(),e}createErrorElement(e){const t=document.createElement("div");return t.className="shelf-error",t.innerHTML=this.getErrorTemplate(e),t}getLoadingTemplate(){return`
      <div class="shelf-content" style="text-align: left; border: 2px solid #007bff; border-radius: 8px; margin: 20px 0; padding: 20px;">
        <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px;"></div>
        <p style="color: #666; font-size: 16px;">Carregando produtos...</p>
      </div>
      <style>
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      </style>
    `}getErrorTemplate(e){return`
      <div style="text-align: left; border: 2px solid #e74c3c; border-radius: 8px; margin: 20px 0; padding: 20px; background-color: #fdf2f2;">
        <p style="color: #e74c3c; margin: 0 0 10px 0;">‚ùå ${e||"Erro ao carregar produtos. Tente novamente mais tarde."}</p>
        <button onclick="location.reload()" style="padding: 8px 16px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">
          Recarregar
        </button>
      </div>
    `}}class m{createElement(e){const t=document.createElement("template");t.innerHTML=e.trim();const o=t.content.firstElementChild;if(!o)throw new Error("Failed to create element from HTML");return o}}var s=(l=>(l.AFTER="after",l.BEFORE="before",l.APPEND="append",l.PREPEND="prepend",l))(s||{});const S=class U{insertElement(e,t){const o=t.containerPosition;return o===s.AFTER||o===s.BEFORE?this.insertAdjacentToTargets(e,o,t.targetSelectors):this.insertIntoContainer(e,t.targetSelectors[0],o)}insertAdjacentToTargets(e,t,o){const n=o.length>0?o:U.DEFAULT_INSERTION_SELECTORS;for(const r of n){const i=document.querySelector(r);if(i)return console.log(`üìç Inserting shelf '${t}' element: ${r}`),i.insertAdjacentElement(t===s.AFTER?"afterend":"beforebegin",e),!0}return console.warn("‚ö†Ô∏è None of the insertion selectors were found:",n),!1}insertIntoContainer(e,t,o){const n=document.querySelector(t);return n?(console.log(`‚úÖ Inserting shelf into: ${t}`),o===s.PREPEND?n.prepend(e):n.appendChild(e),!0):(console.error("‚ùå Container not found:",t),!1)}};S.DEFAULT_INSERTION_SELECTORS=[".recommendations.bg-mainBg",".new-release.bg-mainBg","#shelf-target"];let R=S;class C{constructor(e=new m,t=new R,o=new g){this.elementCreator=e,this.elementInserter=t,this.uiElementFactory=o}insertElement(e,t){return this.elementInserter.insertElement(e,t)}createElement(e){return this.elementCreator.createElement(e)}createLoadingElement(){return this.uiElementFactory.createLoadingElement()}createErrorElement(e){return this.uiElementFactory.createErrorElement(e)}}const I=class y{getBrowserId(){let e=this.getItem(y.BROWSER_ID_KEY);return e||(e=this.generateBrowserId(),this.setItem(y.BROWSER_ID_KEY,e)),e}getCustomerDocument(){let e=this.getItem(y.CUSTOMER_DOC_KEY);return e||(e=this.generateCustomerDocument(),this.setItem(y.CUSTOMER_DOC_KEY,e)),e}setItem(e,t){try{localStorage.setItem(e,t)}catch(o){console.warn("Failed to set localStorage item:",e,o)}}getItem(e){try{return localStorage.getItem(e)}catch(t){return console.warn("Failed to get localStorage item:",e,t),null}}generateBrowserId(){const e=Math.random().toString(36).substr(2,9),t=Date.now();return`browser_${e}_${t}`}generateCustomerDocument(){return(Math.floor(Math.random()*9e8)+1e8).toString()}};I.BROWSER_ID_KEY="browserId",I.CUSTOMER_DOC_KEY="customerDocument";let E=I;class h{constructor(e){this.httpService=e}getConfigs(e){return a(this,null,function*(){try{console.log("üåê [INJECTOR-API] =========================================="),console.log("üîß [INJECTOR-API] Fetching configs for sellerFlavor:",e);const t=`/configs/by-seller/${e}`;console.log("üì° [INJECTOR-API] Request URL:",t),console.log("üîë [INJECTOR-API] API Base URL:",this.httpService.getBaseUrl()),console.log("‚è∞ [INJECTOR-API] Request Time:",new Date().toISOString());const o=performance.now(),n=yield this.httpService.get(t),r=performance.now();return console.log("‚úÖ [INJECTOR-API] Configs fetched successfully"),console.log("‚è±Ô∏è [INJECTOR-API] Response Time:",`${(r-o).toFixed(2)}ms`),console.log("üìä [INJECTOR-API] Response Data:",JSON.stringify(n,null,2)),console.log("üåê [INJECTOR-API] =========================================="),n}catch(t){throw console.error("‚ùå [INJECTOR-API] =========================================="),console.error("‚ùå [INJECTOR-API] Failed to fetch configs for seller:",e),console.error("üì° [INJECTOR-API] Request URL:",`/configs/by-seller/${e}`),console.error("üîç [INJECTOR-API] Error Details:",t),console.error("üåê [INJECTOR-API] =========================================="),new Error(`Failed to fetch configs for seller ${e}: ${t instanceof Error?t.message:"Unknown error"}`)}})}listComponents(e,t){return a(this,null,function*(){try{console.log("üåê [INJECTOR-API] =========================================="),console.log("üîß [INJECTOR-API] Fetching components with IDs:",e.join(", ")),console.log("üè™ [INJECTOR-API] Seller Flavor:",t);const o=`/components/by-ids?ids=${e.join(",")}`;console.log("üì° [INJECTOR-API] Request URL:",o),console.log("üîë [INJECTOR-API] API Base URL:",this.httpService.getBaseUrl()),console.log("üìã [INJECTOR-API] Component IDs Count:",e.length),console.log("‚è∞ [INJECTOR-API] Request Time:",new Date().toISOString());const n=performance.now(),r=yield this.httpService.get(o,{headers:{"seller-flavor":t}}),i=performance.now();return console.log("‚úÖ [INJECTOR-API] Components fetched successfully"),console.log("‚è±Ô∏è [INJECTOR-API] Response Time:",`${(i-n).toFixed(2)}ms`),console.log("üìä [INJECTOR-API] Components Count:",r.length),console.log("üìä [INJECTOR-API] Response Data:",JSON.stringify(r,null,2)),console.log("üåê [INJECTOR-API] =========================================="),r}catch(o){throw console.error("‚ùå [INJECTOR-API] =========================================="),console.error("‚ùå [INJECTOR-API] Failed to fetch components with IDs:",e.join(", ")),console.error("üì° [INJECTOR-API] Request URL:",`/components/by-ids?ids=${e.join(",")}`),console.error("üîç [INJECTOR-API] Error Details:",o),console.error("üåê [INJECTOR-API] =========================================="),new Error(`Failed to fetch components: ${o instanceof Error?o.message:"Unknown error"}`)}})}getTemplate(e,t){return a(this,null,function*(){try{console.log("üåê [INJECTOR-API] =========================================="),console.log("üé® [INJECTOR-API] Fetching template with ID:",e),console.log("üè™ [INJECTOR-API] Seller Flavor:",t);const o=`/templates/${e}`;console.log("üì° [INJECTOR-API] Request URL:",o),console.log("üîë [INJECTOR-API] API Base URL:",this.httpService.getBaseUrl()),console.log("üÜî [INJECTOR-API] Template ID:",e),console.log("‚è∞ [INJECTOR-API] Request Time:",new Date().toISOString());const n=performance.now(),r=yield this.httpService.get(o,{headers:{"seller-flavor":t}}),i=performance.now();return console.log("‚úÖ [INJECTOR-API] Template fetched successfully"),console.log("‚è±Ô∏è [INJECTOR-API] Response Time:",`${(i-n).toFixed(2)}ms`),console.log("üè∑Ô∏è [INJECTOR-API] Template Name:",r.name),console.log("üè™ [INJECTOR-API] Seller Flavor:",r.sellerFlavor),console.log("üìä [INJECTOR-API] Response Data:",JSON.stringify(r,null,2)),console.log("üåê [INJECTOR-API] =========================================="),r}catch(o){throw console.error("‚ùå [INJECTOR-API] =========================================="),console.error("‚ùå [INJECTOR-API] Failed to fetch template with ID:",e),console.error("üì° [INJECTOR-API] Request URL:",`/templates/${e}`),console.error("üîç [INJECTOR-API] Error Details:",o),console.error("üåê [INJECTOR-API] =========================================="),new Error(`Failed to fetch template ${e}: ${o instanceof Error?o.message:"Unknown error"}`)}})}getTemplateLegacy(e,t){return a(this,null,function*(){return console.warn("‚ö†Ô∏è Using legacy getTemplate method. Consider migrating to getTemplate(templateId)"),console.log(`üé® Returning mock template for sellerFlavor: ${e}, templateName: ${t}`),this.getMockTemplate(e,t)})}getMockTemplate(e,t){return{id:1,sellerFlavor:e,name:t,html:this.getShelfTemplate(),css:this.getShelfCSS(),js:void 0,createdAt:new Date,updatedAt:new Date}}getShelfTemplate(){return`
      <div class="w-full my-8 px-4">
        <div class="max-w-7xl mx-auto">
          <!-- Header Section -->
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center">
              <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-gray-900">{{title}}</h2>
            </div>
            <a href="#" class="text-blue-600 hover:text-blue-700 font-medium text-sm">
              Veja todos
            </a>
          </div>

          <!-- Products Slider -->
          <div class="swiffy-slider slider-nav-dark slider-nav-visible slider-nav-autoplay slider-nav-autopause slider-item-show5 slider-item-show3-lg slider-item-show2-md slider-item-show1-sm slider-item-snapstart" data-slider-nav-autoplay-interval="5000">
            <div class="slider-container pb-4">
              {{products}}
            </div>
            
            <!-- Navigation Arrows -->
            <button type="button" class="slider-nav absolute left-0 top-1/2 -translate-y-1/2 w-10 h-10 bg-white shadow-lg rounded-full flex items-center justify-center hover:shadow-xl transition-all duration-200 z-10">
              <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
            </button>
            
            <button type="button" class="slider-nav slider-nav-next absolute right-0 top-1/2 -translate-y-1/2 w-10 h-10 bg-white shadow-lg rounded-full flex items-center justify-center hover:shadow-xl transition-all duration-200 z-10">
              <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    `}getShelfCSS(){return`
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      .swiffy-slider {
        position: relative;
      }
      
      .slider-container {
        display: flex;
        overflow-x: auto;
        scroll-behavior: smooth;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      
      .slider-container::-webkit-scrollbar {
        display: none;
      }
      
      @media (max-width: 640px) {
        .slider-item-show1-sm .slider-container > * {
          flex: 0 0 calc(100% - 16px);
        }
      }
      
      @media (min-width: 641px) and (max-width: 768px) {
        .slider-item-show2-md .slider-container > * {
          flex: 0 0 calc(50% - 16px);
        }
      }
      
      @media (min-width: 769px) and (max-width: 1024px) {
        .slider-item-show3-lg .slider-container > * {
          flex: 0 0 calc(33.333% - 16px);
        }
      }
      
      @media (min-width: 1025px) {
        .slider-item-show5 .slider-container > * {
          flex: 0 0 calc(20% - 16px);
        }
      }
    `}}class f{constructor(e,t,o,n,r,i=[]){this.id=e,this.name=t,this.price=o,this.listPrice=n,this.mainImage=r,this.images=i}get hasDiscount(){return this.listPrice>this.price}get discountPercentage(){return this.hasDiscount?Math.round((this.listPrice-this.price)/this.listPrice*100):0}get installmentPrice(){return this.price/4}generateSlug(){return this.name?`${this.name.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}-${this.id}`:this.id}getMainImage(){var e,t;return((t=(e=this.images)==null?void 0:e[0])==null?void 0:t.imageUrl)||this.mainImage}getHoverImage(){var e,t;return((t=(e=this.images)==null?void 0:e[1])==null?void 0:t.imageUrl)||this.getMainImage()}static fromApiResponse(e){return new f(e.productId,e.productName,e.price,e.listPrice,e.image,e.images||[])}}class _{constructor(e){this.httpService=e}getRecommendations(e,t){return a(this,null,function*(){const o={page:1,perPage:e.maxItems,products:[],browserId:e.browserId,documentType:"cpf",customerDocument:e.customerDocument,filterAlreadyBought:e.excludeViewed};try{const n=`/products/${e.recommendationType}/${t}`;console.log("üîç [RECOMMENDATIONS] Making request to:",n),console.log("üîç [RECOMMENDATIONS] Full URL will be:",this.httpService.getBaseUrl()+n),console.log("üîç [RECOMMENDATIONS] Request data:",JSON.stringify(o,null,2));const r=yield this.httpService.post(n,o);return!r.products||!Array.isArray(r.products)?(console.error("Invalid API response: products array missing or invalid"),[]):r.products.map(c=>f.fromApiResponse(c))}catch(n){throw console.error("Failed to get recommendations:",n),n}})}}class P{constructor(e,t){this.data=e,this.template=t}get title(){return this.data.title}get products(){return this.data.products}get configuration(){return this.data.configuration}get productCount(){return this.data.products.length}hasProducts(){return this.data.products.length>0}getProductsHtml(){return this.data.products.map(e=>this.renderProductCard(e)).join("")}renderProductCard(e){return this.renderProductFromTemplate(e)}renderProductFromTemplate(e){var i;const t=e.installmentPrice.toFixed(2),o=this.extractVariantId(e),n={id:e.id.toString(),name:e.name,slug:e.generateSlug(),mainImage:e.getMainImage(),price:e.price.toFixed(2),listPrice:e.listPrice.toFixed(2),installmentPrice:t,discountPercentage:((i=e.discountPercentage)==null?void 0:i.toString())||"0",hasDiscount:e.hasDiscount?"true":"false",variantId:o||"",discountBadge:e.hasDiscount?`<div class="product-badge">-${e.discountPercentage}%</div>`:"",listPriceSection:e.hasDiscount?`<div style="font-size: 0.875rem; color: #a0aec0; text-decoration: line-through; margin-bottom: 4px;">de R$ ${e.listPrice.toFixed(2)}</div>`:"",ratingStars:""};let r=this.getProductCardTemplate();return Object.entries(n).forEach(([c,d])=>{const p=new RegExp(`{{${c}}}`,"g");r=r.replace(p,d)}),r}getProductCardTemplate(){const e=this.template.html.match(new RegExp('<template id="product-card-template">(.*?)<\\/template>',"s"));if(e)return e[1].trim();throw new Error(`No product card template found in database template for seller: ${this.template.sellerFlavor}`)}extractVariantId(e){const t=e.getMainImage();if(!t)return null;const o=t.match(/\/(\d+)(?:-\d+)?\.jpg/);return o?o[1]:null}replacePlaceholders(e,t){let o=e;return Object.entries(t).forEach(([n,r])=>{const i=new RegExp(`{{${n}}}`,"g");o=o.replace(i,r)}),o}renderShelfHtml(){let e=this.template.html;return e=this.replacePlaceholders(e,{title:this.title,products:this.getProductsHtml(),productCount:this.productCount.toString()}),e=e.replace(new RegExp('<template id="product-card-template">.*?<\\/template>',"s"),""),this.template.css&&(e+=`
<style>
${this.template.css}
</style>`),e}}class L{constructor(e,t,o){this.templateRepository=e,this.domRepository=t,this.recommendationApiRepository=o}renderShelvesForSeller(e){return a(this,null,function*(){console.log("üõçÔ∏è Starting database-driven shelf rendering for seller:",e.sellerFlavor);const t=yield this.templateRepository.getConfigs(e.sellerFlavor);console.log("üìã Configs retrieved:",t);let o=[];console.log("üìã Processing array of configs, count:",t.length);for(const i of t)if(i.components)if(typeof i.components=="object"&&"components"in i.components){const c=i.components.components;Array.isArray(c)&&(o.push(...c),console.log("üìã Extracted nested component IDs:",c))}else Array.isArray(i.components)&&(o.push(...i.components),console.log("üìã Extracted direct component IDs:",i.components));if(console.log("üìã Final component IDs to fetch:",o),!o||o.length===0){console.log("‚ÑπÔ∏è No components configured for seller:",e.sellerFlavor);return}const n=yield this.templateRepository.listComponents(o,e.sellerFlavor);console.log("üß© Components retrieved:",n);const r=n.filter(i=>i.enabled);if(console.log(`üîß Found ${r.length} enabled components out of ${n.length} total`),r.length===0){console.log("‚ÑπÔ∏è No enabled components found");return}for(const i of r)yield this.renderComponent(i,e.browserId,e.customerDocument,e.sellerFlavor);console.log("‚úÖ All enabled components processed successfully")})}renderComponent(e,t,o,n){return a(this,null,function*(){var d,p,O,N;console.log(`üî® Rendering component: ${e.name} (ID: ${e.id})`);const r={title:((d=e.props)==null?void 0:d.title)||"Produtos Recomendados",maxItems:((p=e.props)==null?void 0:p.maxItems)||12,excludeViewed:((O=e.props)==null?void 0:O.excludeViewed)||!1,containerPosition:((N=e.props)==null?void 0:N.containerPosition)||s.APPEND,targetSelectors:e.injectLocation?[e.injectLocation]:["#shelf-target"]},i=this.domRepository.createLoadingElement();if(!this.domRepository.insertElement(i,r))throw console.error("‚ùå Failed to insert loading element into DOM"),new Error("Failed to insert loading element into DOM");try{const u=yield this.recommendationApiRepository.getRecommendations({maxItems:r.maxItems,excludeViewed:r.excludeViewed,browserId:t,customerDocument:o,recommendationType:e.recommendationType},e.sellerFlavor);if(u.length===0){console.warn("No products found for component, removing loading element"),i.remove();return}const v=yield this.templateRepository.getTemplate(e.templateId,n),F=new P({title:r.title,products:u,configuration:r},v).renderShelfHtml(),D=this.domRepository.createElement(F);i.replaceWith(D),this.initializeSlider(D),console.log(`‚úÖ Component ${e.name} rendered successfully`)}catch(u){console.error(`‚ùå Error rendering component ${e.name}:`,u);const v=this.domRepository.createErrorElement(u instanceof Error?u.message:"Unknown error");throw i.replaceWith(v),u}})}renderShelf(e){return a(this,null,function*(){console.log("üõçÔ∏è Starting shelf rendering:",e.configuration);const t=this.domRepository.createLoadingElement();if(!this.domRepository.insertElement(t,e.configuration))throw console.error("‚ùå Failed to insert shelf into DOM"),new Error("Failed to insert shelf into DOM");try{const n=yield this.recommendationApiRepository.getRecommendations({maxItems:e.configuration.maxItems,excludeViewed:e.configuration.excludeViewed,browserId:e.browserId,customerDocument:e.customerDocument,recommendationType:e.recommendationType},e.sellerFlavor);if(n.length===0){console.warn("No products found, removing loading element"),t.remove();return}const r=yield this.templateRepository.getTemplateLegacy(e.sellerFlavor,e.templateName),c=new P({title:e.configuration.title,products:n,configuration:e.configuration},r).renderShelfHtml(),d=this.domRepository.createElement(c);t.replaceWith(d),this.initializeSlider(d),console.log("‚úÖ Shelf rendered successfully")}catch(n){console.error("‚ùå Error rendering shelf:",n);const r=this.domRepository.createErrorElement(n instanceof Error?n.message:"Unknown error");throw t.replaceWith(r),n}})}validateRenderRequest(e){if(!e.sellerFlavor)throw new Error("Seller flavor is required");if(!e.templateName)throw new Error("Template name is required");if(!e.configuration)throw new Error("Configuration is required");if(!e.configuration.title)throw new Error("Configuration title is required")}initializeSlider(e){console.log("üé† Initializing Swiffy Slider..."),console.log("üîç Shelf element:",e),console.log("üîç Shelf element innerHTML preview:",e.innerHTML.substring(0,200)+"...");const t=e.querySelector(".swiffy-slider");if(console.log("üîç Found slider element:",!!t),!t){console.warn("‚ö†Ô∏è No slider element found in shelf"),console.log('üîç Looking for elements with classes containing "swiffy":',Array.from(e.querySelectorAll("*")).filter(o=>o.className&&o.className.includes&&o.className.includes("swiffy")));return}console.log("üîç Slider element classes:",t.className),console.log("üîç Slider element children count:",t.children.length),typeof window.swiffyslider=="undefined"?(console.log("üì¶ Loading Swiffy Slider library..."),this.loadSwiffySlider().then(()=>{console.log("‚úÖ Swiffy Slider library loaded, initializing..."),this.initSlider(t)}).catch(o=>{console.error("‚ùå Failed to load Swiffy Slider:",o)})):(console.log("‚úÖ Swiffy Slider library already available, initializing..."),this.initSlider(t))}loadSwiffySlider(){return new Promise((e,t)=>{const o=document.createElement("link");o.rel="stylesheet",o.href="https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/css/swiffy-slider.min.css",document.head.appendChild(o);const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/js/swiffy-slider.min.js",n.onload=()=>e(),n.onerror=()=>t(new Error("Failed to load Swiffy Slider script")),document.head.appendChild(n)})}initSlider(e){const t=window.swiffyslider;if(console.log("üîç Swiffy Slider library status:",{available:!!t,type:typeof t,methods:t?Object.keys(t):"N/A"}),e&&t){console.log("‚úÖ Initializing Swiffy Slider on element..."),console.log("üîç Element before init:",e.outerHTML.substring(0,300)+"...");try{t.init(e),console.log("‚úÖ Swiffy Slider initialized successfully"),console.log("üîç Element after init:",e.outerHTML.substring(0,300)+"...");const o=e.querySelectorAll(".slider-nav");console.log("üîç Navigation buttons found:",o.length),o.forEach((n,r)=>{console.log(`üîç Nav button ${r}:`,{classList:Array.from(n.classList),hasClickListener:!!n.onclick,tagName:n.tagName})})}catch(o){console.error("‚ùå Error during Swiffy Slider initialization:",o)}}else console.error("‚ùå Swiffy Slider element or library not found",{element:!!e,library:!!t})}}class b{constructor(e){this.config=e}get(e,t){return a(this,null,function*(){console.log("üåê [HTTP] ============================================"),console.log("üöÄ [HTTP] Making GET request"),console.log("üì° [HTTP] URL:",this.config.apiUrl+e),console.log("üîë [HTTP] Headers:",this.getLoggableHeaders(t)),console.log("‚è∞ [HTTP] Request Time:",new Date().toISOString());const o=performance.now(),n=yield this.makeRequest("GET",e,void 0,t),r=performance.now();return console.log("‚úÖ [HTTP] GET request completed"),console.log("‚è±Ô∏è [HTTP] Response Time:",`${(r-o).toFixed(2)}ms`),console.log("üìä [HTTP] Status:",n.status,n.statusText),console.log("üåê [HTTP] ============================================"),n.json()})}post(e,t,o){return a(this,null,function*(){console.log("üåê [HTTP] ============================================"),console.log("üöÄ [HTTP] Making POST request"),console.log("üì° [HTTP] URL:",this.config.apiUrl+e),console.log("üîë [HTTP] Headers:",this.getLoggableHeaders(o)),console.log("üì§ [HTTP] Request Body:",JSON.stringify(t,null,2)),console.log("‚è∞ [HTTP] Request Time:",new Date().toISOString());const n=performance.now(),r=yield this.makeRequest("POST",e,t,o),i=performance.now();return console.log("‚úÖ [HTTP] POST request completed"),console.log("‚è±Ô∏è [HTTP] Response Time:",`${(i-n).toFixed(2)}ms`),console.log("üìä [HTTP] Status:",r.status,r.statusText),console.log("üåê [HTTP] ============================================"),r.json()})}makeRequest(e,t,o,n){return a(this,null,function*(){const r=T(T({"Content-Type":"application/json"},this.getDefaultHeaders()),n==null?void 0:n.headers),i={method:e,headers:r};if(o&&(e==="POST"||e==="PUT"||e==="PATCH")&&(i.body=JSON.stringify(o)),this.config.timeout){const p=new AbortController;i.signal=p.signal,setTimeout(()=>p.abort(),this.config.timeout)}const c=this.config.apiUrl+t,d=yield fetch(c,i);if(!d.ok)throw new Error(`HTTP Error ${d.status}: ${d.statusText}`);return d})}getDefaultHeaders(){const e={};return this.config.apiKey&&(e["x-api-key"]=this.config.apiKey),e}getBaseUrl(){return this.config.apiUrl}getLoggableHeaders(e){const t=T(T({},this.getDefaultHeaders()),e==null?void 0:e.headers),o={};for(const[n,r]of Object.entries(t))n.toLowerCase().includes("authorization")||n.toLowerCase().includes("key")?o[n]="***REDACTED***":o[n]=r;return o}}class w{constructor(e){this.config=e,this.initializeHttpServices(),this.initializeRepositories(),this.initializeServices()}static getInstance(e){if(!w.instance){if(!e)throw new Error("Container must be initialized with config");w.instance=new w(e)}return w.instance}initializeHttpServices(){this.recommendationsHttpService=new b({apiUrl:this.config.recommendationsApiUrl||this.config.apiUrl,apiKey:this.config.recommendationsApiKey||this.config.apiKey,timeout:this.config.timeout}),this.injectorHttpService=new b({apiUrl:this.config.injectorApiUrl||this.config.apiUrl,apiKey:this.config.injectorApiKey||this.config.apiKey,timeout:this.config.timeout})}initializeRepositories(){this.recommendationsRepository=new _(this.recommendationsHttpService),this.injectorRepository=new h(this.injectorHttpService),this.domAdapter=new C,this.storageService=new E}initializeServices(){this.injectorApiService=new L(this.injectorRepository,this.domAdapter,this.recommendationsRepository)}getInjectorApiService(){return this.injectorApiService}getStorageService(){return this.storageService}getRecommendationsRepository(){return this.recommendationsRepository}getInjectorRepository(){return this.injectorRepository}getDomAdapter(){return this.domAdapter}replaceDependency(e,t){this[e]=t}}class A{static load(){const e={VITE_DEBUG_MODE:"false",VITE_RECOMMENDATIONS_API_TIMEOUT:"10000",VITE_DEFAULT_SHELF_TITLE:"Produtos Recomendados",VITE_DEFAULT_MAX_ITEMS:"12",VITE_SWIFFY_SLIDER_JS_URL:"https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/js/swiffy-slider.min.js",VITE_SWIFFY_SLIDER_CSS_URL:"https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/css/swiffy-slider.min.css",VITE_RECOMMENDATIONS_API_URL:"https://gol0qozv97.execute-api.us-east-1.amazonaws.com/qa",VITE_RECOMMENDATIONS_API_KEY:"8QD7vDvrOn1D6goXfc5xg7p7OYNc71Tr7YI59xaI",VITE_INJECTOR_API_URL:"https://ah3qg6m5mi.execute-api.us-east-1.amazonaws.com/qa",VITE_INJECTOR_API_KEY:"JyDAREDeom6gKVwAhUy5f9zmHEHCz0N5Q6mEVBmc",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,RECOMMENDATIONS_API_URL:"",RECOMMENDATIONS_API_KEY:"",RECOMMENDATIONS_API_TIMEOUT:"10000",DEFAULT_SHELF_TITLE:"Produtos Recomendados",DEFAULT_MAX_ITEMS:"12",SWIFFY_SLIDER_JS_URL:"https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/js/swiffy-slider.min.js",SWIFFY_SLIDER_CSS_URL:"https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/css/swiffy-slider.min.css",DEBUG_MODE:"false"};console.log("ENV Debug:",e),console.log("VITE vars:",Object.keys(e).filter(i=>i.startsWith("VITE_")));const t=e.VITE_INJECTOR_API_URL,o=e.VITE_INJECTOR_API_KEY,n=e.VITE_RECOMMENDATIONS_API_URL,r=e.VITE_RECOMMENDATIONS_API_KEY;return console.log("Config:",{injectorApiUrl:t,injectorApiKey:"SET",recommendationsApiUrl:n,recommendationsApiKey:"SET"}),{apiUrl:n,apiKey:r,apiTimeout:parseInt(e.VITE_RECOMMENDATIONS_API_TIMEOUT,10),recommendationsApiUrl:n,recommendationsApiKey:r,injectorApiUrl:t,injectorApiKey:o,defaultShelfTitle:e.VITE_DEFAULT_SHELF_TITLE,defaultMaxItems:parseInt(e.VITE_DEFAULT_MAX_ITEMS,10),swiffySliderJsUrl:e.VITE_SWIFFY_SLIDER_JS_URL,swiffySliderCssUrl:e.VITE_SWIFFY_SLIDER_CSS_URL,debugMode:e.VITE_DEBUG_MODE==="true"}}static validate(e){const t=["apiUrl","apiKey"];for(const o of t)if(!e[o])throw new Error(`Missing required environment variable: ${o}`);if(e.apiTimeout<=0)throw new Error("API timeout must be greater than 0");if(e.defaultMaxItems<=0)throw new Error("Default max items must be greater than 0")}}class M{constructor(){try{this.window=window,console.log("üîß Loading environment configuration...");const e=A.load();console.log("üîß Environment config loaded:",{hasApiUrl:!!e.apiUrl,apiUrl:e.apiUrl,hasApiKey:!!e.apiKey,hasInjectorApiUrl:!!e.injectorApiUrl,injectorApiUrl:e.injectorApiUrl,hasInjectorApiKey:!!e.injectorApiKey,timeout:e.apiTimeout,recommendationsApiUrl:e.recommendationsApiUrl,recommendationsApiKey:e.recommendationsApiKey?"SET":"NOT_SET"}),A.validate(e),console.log("‚úÖ Environment configuration validated");const t={apiUrl:e.apiUrl,apiKey:e.apiKey,timeout:e.apiTimeout,recommendationsApiUrl:e.recommendationsApiUrl,recommendationsApiKey:e.recommendationsApiKey,injectorApiUrl:e.injectorApiUrl,injectorApiKey:e.injectorApiKey};console.log("üîß Initializing dependency container..."),this.container=w.getInstance(t),this.injectorService=this.container.getInjectorApiService(),this.storageService=this.container.getStorageService(),console.log("‚úÖ Services initialized successfully")}catch(e){throw console.error("‚ùå Failed to initialize GTMLoader constructor:",e),e}}initialize(){try{if(console.log("üöÄ Initializing ComponentInjector with Clean Architecture..."),this.window.ComponentInjector){console.log("‚ö†Ô∏è ComponentInjector already exists");return}console.log("üîß Creating ComponentInjector on window object..."),this.window.ComponentInjector={load:()=>this.load()},console.log("üîß Setting up global functions..."),this.setupGlobalFunctions(),console.log("‚úÖ ComponentInjector created successfully"),this.window.ComponentInjector&&typeof this.window.ComponentInjector.load=="function"?console.log("‚úÖ ComponentInjector.load method is available"):console.error("‚ùå ComponentInjector.load method is not available after creation")}catch(e){throw console.error("‚ùå Failed to initialize ComponentInjector:",e),e}}loadComponents(e,t,o,n){return a(this,null,function*(){console.log("üîç loadComponents called with:",{containerId:e,sellerFlavor:t,templateName:o,recommendationType:n}),e?(console.log(`üì¶ Loading recommendations into container: ${e}`),yield this.loadRecommendations(e,t,o,n)):(console.log("üì¶ Loading components from window configuration..."),console.log("üîç About to call this.load()..."),this.load(),console.log("‚úÖ this.load() completed"))})}loadRecommendations(e,t,o,n){return a(this,null,function*(){console.log(`üì¶ Loading recommendations into container: ${e}`,{sellerFlavor:t,templateName:o,recommendationType:n});const i={clientId:"gtm-loader",components:[{id:"recommendations",type:"shelf",selector:e.startsWith("#")?e:`#${e}`,enabled:!0,props:{sellerFlavor:t,templateName:o,containerPosition:s.APPEND,maxItems:10,excludeViewed:!1,title:"Recommended Products"}}]};yield this.initializeComponents(i)})}load(){if(console.log("üì¶ Loading components..."),console.log("üîç Checking for window.componentInjectorConfig..."),console.log("üîç window.componentInjectorConfig exists:",!!this.window.componentInjectorConfig),this.window.componentInjectorConfig&&console.log("üîç Found config:",this.window.componentInjectorConfig),!this.window.componentInjectorConfig)throw new Error("Configuration `componentInjectorConfig` not found on window.");if(!this.window.componentInjectorConfig.clientId)throw new Error("clientId is required for database-driven component loading");console.log("üóÑÔ∏è Using database-driven component loading for clientId:",this.window.componentInjectorConfig.clientId),this.loadComponentsFromDatabase(this.window.componentInjectorConfig.clientId)}loadComponentsFromDatabase(e){return a(this,null,function*(){console.log("üóÑÔ∏è Loading components from database for seller:",e),(!e||e==="test-client-001"||e==="gtm-loader")&&(e="limppano",console.log("üîÑ [GTM-LOADER] Using test seller:",e));const t=this.storageService.getBrowserId(),o=this.storageService.getCustomerDocument();console.log("üîç [GTM-LOADER] Database loading parameters:",{sellerFlavor:e,browserId:t?t.substring(0,8)+"...":"null",customerDocument:o?o.substring(0,8)+"...":"null"}),yield this.injectorService.renderShelvesForSeller({sellerFlavor:e,browserId:t,customerDocument:o}),console.log("‚úÖ Database-driven component loading completed successfully")})}initializeComponents(e){return a(this,null,function*(){if(console.log("üéØ Initializing components..."),!e||!e.components)throw new Error("Invalid configuration: components array missing");const t=e.components.filter(o=>o.enabled);if(t.length===0){console.log("‚ÑπÔ∏è No enabled components found");return}console.log(`üîß Found ${t.length} enabled components`);for(const o of t)yield this.processComponent(o)})}processComponent(e){return a(this,null,function*(){if(console.log(`üî® Processing component: ${e.id} (${e.type})`),e.type==="shelf")yield this.initializeShelf(e);else throw new Error(`Unknown component type: ${e.type}`)})}initializeShelf(e){return a(this,null,function*(){const t=e.props,o=A.load(),n={title:t.title||o.defaultShelfTitle,maxItems:t.maxItems||o.defaultMaxItems,excludeViewed:t.excludeViewed||!1,containerPosition:t.containerPosition||s.APPEND,targetSelectors:t.targetSelectors||[e.selector]},r=this.storageService.getBrowserId(),i=this.storageService.getCustomerDocument(),c=t.sellerFlavor||"limppano",d=t.templateName||"default",p=t.recommendationType||"popular";console.log("üîç [GTM-LOADER] Using seller configuration:",{sellerFlavor:c,templateName:d,recommendationType:p,fromProps:!!t.sellerFlavor}),yield this.injectorService.renderShelf({sellerFlavor:c,templateName:d,recommendationType:p,configuration:n,browserId:r,customerDocument:i}),console.log(`‚úÖ Shelf component ${e.id} initialized successfully`)})}setupGlobalFunctions(){const e=this.window;e.spotAddToCartButtonClick||(e.spotAddToCartButtonClick=t=>{console.log("üõí Add to cart clicked:",t)}),e.wishlistAddClick||(e.wishlistAddClick=(t,o)=>{console.log("‚ù§Ô∏è Wishlist clicked:",o)}),e.spotBuyButtonClick||(e.spotBuyButtonClick=t=>{console.log("üí≥ Buy button clicked:",t)})}}window.addEventListener("load",function(){(function(){console.log("üöÄ Starting ComponentInjector with Clean Architecture...");const l=new M;l.initialize();const e={load:(t,o,n,r)=>{console.log("üéØ ComponentInjector.load called:",{containerId:t,sellerFlavor:o,templateName:n,recommendationType:r}),console.log("üîç About to call gtmLoader.loadComponents...");const i=l.loadComponents(t,o,n,r);return console.log("‚úÖ gtmLoader.loadComponents completed, result:",i),i}};window.ComponentInjector=e,console.log("‚úÖ GTM Loader initialized successfully"),console.log("‚úÖ ComponentInjector created with load method"),console.log("‚úÖ ComponentInjector attached to window object"),console.log("üîç ComponentInjector structure:",e),console.log("üîç window.ComponentInjector keys:",Object.keys(window.ComponentInjector)),window.ComponentInjector&&typeof window.ComponentInjector.load=="function"?console.log("‚úÖ ComponentInjector.load method is available and callable"):console.error("‚ùå ComponentInjector.load method is not available")})()})})();
